<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - MindCare</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <link
            rel="stylesheet"
            href="{{ url_for('static', filename='style.css') }}"
        />
        <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
    <style>
        /* Custom scrollbar for a cleaner look in webkit browsers */
        .sidebar-scroll::-webkit-scrollbar {
            width: 4px;
        }
        .sidebar-scroll::-webkit-scrollbar-thumb {
            background-color: #a8a29e;
            border-radius: 20px;
        }
        body 
        {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f9f9f9;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #2a2c74;
        }

        /* Summary cards */
        .summary-row {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .summary-card {
            flex: 1;
            min-width: 250px;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            color: white;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .summary-card h2 {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .summary-card p {
            font-size: 26px;
            font-weight: bold;
        }

        .summary-card.purple {
            background-color: #6c5ce7;
        }
        .summary-card.dark {
            background-color: #2d1f66;
        }
        .summary-card.light {
            background-color: #a29bfe;
        }

        /* Filters */
        .filters {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .filters label {
            font-weight: bold;
            color: #333;
        }

        .filters select,
        .filters button {
            padding: 6px 10px;
            margin-left: 5px;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        .filters button {
            background-color: #2a2c74;
            color: white;
            cursor: pointer;
            border: none;
        }

        .filters button:hover {
            background-color: #4446a3;
        }

        /* Charts */
        .chart-row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .card {
            background: #fff;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            flex: 1;
            min-width: 320px;
        }

        .card.full-width {
            flex: 1 1 100%;
        }

        .card.half-width {
            flex: 1 1 45%;
        }

        canvas {
            width: 100% !important;
            height: 400px !important; /* Increased height for better visibility */
        }

    </style>
</head>
<body class="bg-stone-100 font-sans">

    <div class="flex h-screen bg-stone-100">
        <div class="hidden md:flex flex-col w-64 bg-white shadow-lg">
            <div class="flex items-center justify-center h-16 bg-white shadow-sm">
                <i data-feather="heart" class="text-green-800 h-8 w-8"></i>
                <span class="ml-2 text-xl font-bold text-green-800">MindCare</span>
            </div>
            <div class="flex flex-col flex-grow overflow-y-auto sidebar-scroll">
                <nav class="flex-grow px-4 py-4">
                    <a href="#" class="flex items-center px-4 py-2 text-white bg-green-800 rounded-lg">
                        <i data-feather="home" class="h-5 w-5"></i>
                        <span class="ml-3">Dashboard</span>
                    </a>
                    <span class="block mt-4 mb-2 ml-4 text-xs font-semibold text-stone-500 uppercase tracking-wider">Analytics</span>
                    <a href="#" class="flex items-center px-4 py-2 mt-2 text-stone-600 hover:bg-stone-200 hover:text-stone-800 rounded-lg">
                        <i data-feather="users" class="h-5 w-5"></i>
                        <span class="ml-3">Users</span>
                    </a>
                    <a href="#" class="flex items-center px-4 py-2 mt-2 text-stone-600 hover:bg-stone-200 hover:text-stone-800 rounded-lg">
                        <i data-feather="bar-chart-2" class="h-5 w-5"></i>
                        <span class="ml-3">Age Group</span>
                    </a>
                    <a href="#" class="flex items-center px-4 py-2 mt-2 text-stone-600 hover:bg-stone-200 hover:text-stone-800 rounded-lg">
                        <i data-feather="activity" class="h-5 w-5"></i>
                        <span class="ml-3">Active Users</span>
                    </a>
                    <a href="#" class="flex items-center px-4 py-2 mt-2 text-stone-600 hover:bg-stone-200 hover:text-stone-800 rounded-lg">
                        <i data-feather="user-check" class="h-5 w-5"></i>
                        <span class="ml-3">Gender</span>
                    </a>
                    <a href="#" class="flex items-center px-4 py-2 mt-2 text-stone-600 hover:bg-stone-200 hover:text-stone-800 rounded-lg">
                        <i data-feather="shield" class="h-5 w-5"></i>
                        <span class="ml-3">Composite Risk</span>
                    </a>
                    
                    <span class="block mt-4 mb-2 ml-4 text-xs font-semibold text-stone-500 uppercase tracking-wider">Demographics</span>
                     <a href="#" class="flex items-center px-4 py-2 mt-2 text-stone-600 hover:bg-stone-200 hover:text-stone-800 rounded-lg">
                        <i data-feather="map-pin" class="h-5 w-5"></i>
                        <span class="ml-3">District</span>
                    </a>
                    <a href="#" class="flex items-center px-4 py-2 mt-2 text-stone-600 hover:bg-stone-200 hover:text-stone-800 rounded-lg">
                        <i data-feather="briefcase" class="h-5 w-5"></i>
                        <span class="ml-3">College</span>
                    </a>
                    <a href="#" class="flex items-center px-4 py-2 mt-2 text-stone-600 hover:bg-stone-200 hover:text-stone-800 rounded-lg">
                        <i data-feather="award" class="h-5 w-5"></i>
                        <span class="ml-3">Year of Study</span>
                    </a>
                    <a href="#" class="flex items-center px-4 py-2 mt-2 text-stone-600 hover:bg-stone-200 hover:text-stone-800 rounded-lg">
                        <i data-feather="book-open" class="h-5 w-5"></i>
                        <span class="ml-3">Course</span>
                    </a>
                </nav>
            </div>
        </div>

        <div class="flex flex-col flex-1 overflow-y-auto">
            <div class="flex items-center justify-between h-16 bg-white border-b border-stone-200 shadow-sm px-6">
                <div class="flex items-center">
                    <button class="md:hidden text-stone-600 focus:outline-none">
                        <i data-feather="menu" class="h-6 w-6"></i>
                    </button>
                    <h1 class="text-xl font-semibold text-stone-800 ml-4 md:ml-0">Dashboard Overview</h1>
                </div>
                <div class="flex items-center">
                    <span class="mr-3 font-medium text-stone-700">Admin</span>
                    <a href="#" class="text-stone-600 hover:text-red-600">
                        <i data-feather="log-out" class="h-5 w-5"></i>
                    </a>
                </div>
            </div>
            
            <div class="p-6 md:p-8">
                <h2 class="text-2xl font-bold text-green-900">Welcome back, Admin!</h2>
                <p class="mt-2 text-stone-600">Here's a summary of the platform's activity.</p>
                
                <div class="mt-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-stone-500 font-medium">Total Users</h3>
                        <p class="text-3xl font-bold text-green-800 mt-2">1,250</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-stone-500 font-medium">Active Users (24h)</h3>
                        <p class="text-3xl font-bold text-green-800 mt-2">320</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-stone-500 font-medium">New Signups (Month)</h3>
                        <p class="text-3xl font-bold text-green-800 mt-2">85</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-stone-500 font-medium">High-Risk Alerts</h3>
                        <p class="text-3xl font-bold text-red-600 mt-2">12</p>
                    </div>
                </div>
                
                <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
                    <h3 class="font-medium text-stone-800">User Activity Chart</h3>
                    <div class="mt-4 h-64 bg-stone-200 rounded flex items-center justify-center">
                       
                        <div class="chart-row">
                            <div class="card"><canvas id="courseChart"></canvas></div>
                            <div class="card"><canvas id="genderChart"></canvas></div>
                        </div>
                        <div class="chart-row">
                            <div class="card"><canvas id="riskChart"></canvas></div>
                            <div class="card"><canvas id="ageChart"></canvas></div>
                        </div>
                        <div class="chart-row">
                            <div class="card"><canvas id="districtChart"></canvas></div>
                            <div class="card"><canvas id="collegeChart"></canvas></div>
                        </div>
                        <div class="chart-row">
                            <div class="card half-width"><canvas id="yearStudyChart"></canvas></div>
                            <div class="card half-width empty"></div>
                        </div>

                        <h2 style="text-align: center;">Mental Health Scores</h2>
                        <div class="chart-row">
                            <div class="card"><canvas id="phqChart"></canvas></div>
                            <div class="card"><canvas id="gadChart"></canvas></div>
                        </div>
                        <div class="chart-row">
                            <div class="card half-width"><canvas id="ghqChart"></canvas></div>
                            <div class="card half-width empty"></div>
                        </div>
                        
                        <h2 style="text-align: center;">Correlation and Insights</h2>
                        <div class="chart-row">
                            <div class="card"><canvas id="phqVsGadScatter"></canvas></div>
                            <div class="card"><canvas id="gadVsGhqScatter"></canvas></div>
                            <div class="card"><canvas id="phqVsGhqScatter"></canvas></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        const data = {{ data_json|safe }};

            // New Demographics Charts
            // Course Chart
            const courseCtx = document.getElementById('courseChart').getContext('2d');
            new Chart(courseCtx, {
                type: 'bar',
                data: {
                    labels: data.demographics.courses.labels,
                    datasets: [{
                        label: 'Distribution by Course',
                        data: data.demographics.courses.values,
                        backgroundColor: '#6b5ac7'
                    }]
                },
                options: { 
                    responsive: true,
                    devicePixelRatio: window.devicePixelRatio,
                    title: {
                        display: true,
                        text: 'Distribution by Course',
                        fontSize: 16
                    },
                    scales: {
                        yAxes: [{
                            ticks: {
                                fontSize: 12
                            }
                        }],
                        xAxes: [{
                            ticks: {
                                fontSize: 12
                            }
                        }]
                    }
                }
            });

            // Gender Chart with Datalabels
            const genderCtx = document.getElementById('genderChart').getContext('2d');
            new Chart(genderCtx, {
                type: 'pie',
                data: {
                    labels: data.demographics.genders.labels,
                    datasets: [{
                        label: 'Gender Distribution',
                        data: data.demographics.genders.values,
                        backgroundColor: ['#2a2c74', '#6b5ac7', '#a192f7', '#00C49A', '#FFBB28']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {
                        padding: {
                            left: 0,
                            right: 0,
                            top: 0,
                            bottom: 0
                        }
                    },
                    plugins: {
                        datalabels: {
                            formatter: (value, ctx) => {
                                let sum = 0;
                                let dataArr = ctx.chart.data.datasets[0].data;
                                dataArr.map(data => {
                                    sum += data;
                                });
                                let percentage = (value * 100 / sum).toFixed(2) + "%";
                                return percentage;
                            },
                            color: '#fff',
                            font: {
                                weight: 'bold',
                                size: 14,
                            }
                        }
                    },
                    devicePixelRatio: window.devicePixelRatio,
                    title: {
                        display: true,
                        text: 'Gender Distribution',
                        fontSize: 16
                    }
                }
            });

            // Risk Chart
            const riskCtx = document.getElementById('riskChart').getContext('2d');
            new Chart(riskCtx, {
                type: 'bar',
                data: {
                    labels: data.demographics.risks.labels,
                    datasets: [{
                        label: 'Composite Risk Breakdown',
                        data: data.demographics.risks.values,
                        backgroundColor: '#2a2c74'
                    }]
                },
                options: { 
                    responsive: true,
                    devicePixelRatio: window.devicePixelRatio,
                    title: {
                        display: true,
                        text: 'Composite Risk Breakdown',
                        fontSize: 16
                    },
                    scales: {
                        yAxes: [{
                            ticks: {
                                fontSize: 12
                            }
                        }],
                        xAxes: [{
                            ticks: {
                                fontSize: 12
                            }
                        }]
                    }
                }
            });

            // Age Chart
            const ageCtx = document.getElementById('ageChart').getContext('2d');
            new Chart(ageCtx, {
                type: 'bar',
                data: {
                    labels: data.demographics.ages.labels,
                    datasets: [{
                        label: 'Age Group Distribution',
                        data: data.demographics.ages.values,
                        backgroundColor: '#a192f7'
                    }]
                },
                options: { 
                    responsive: true,
                    devicePixelRatio: window.devicePixelRatio,
                    title: {
                        display: true,
                        text: 'Age Group Distribution',
                        fontSize: 16
                    },
                    scales: {
                        yAxes: [{
                            ticks: {
                                fontSize: 12
                            }
                        }],
                        xAxes: [{
                            ticks: {
                                fontSize: 12
                            }
                        }]
                    }
                }
            });
            
            // District Chart with Datalabels
            const districtCtx = document.getElementById('districtChart').getContext('2d');
            new Chart(districtCtx, {
                type: 'pie',
                data: {
                    labels: data.demographics.districts.labels,
                    datasets: [{
                        label: 'District-wise Distribution',
                        data: data.demographics.districts.values,
                        backgroundColor: ['#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd', '#8c564b', '#e377c2', '#7f7f7f', '#bcbd22', '#17becf']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {
                        padding: {
                            left: 0,
                            right: 0,
                            top: 0,
                            bottom: 0
                        }
                    },
                    plugins: {
                        datalabels: {
                            formatter: (value, ctx) => {
                                let sum = 0;
                                let dataArr = ctx.chart.data.datasets[0].data;
                                dataArr.map(data => {
                                    sum += data;
                                });
                                let percentage = (value * 100 / sum).toFixed(2) + "%";
                                return percentage;
                            },
                            color: '#fff',
                            font: {
                                weight: 'bold',
                                size: 14,
                            }
                        }
                    },
                    devicePixelRatio: window.devicePixelRatio,
                    title: {
                        display: true,
                        text: 'District-wise Distribution',
                        fontSize: 16
                    }
                }
            });
            
            // College Chart with Datalabels
            const collegeCtx = document.getElementById('collegeChart').getContext('2d');
            new Chart(collegeCtx, {
                type: 'pie',
                data: {
                    labels: data.demographics.colleges.labels,
                    datasets: [{
                        label: 'College Distribution',
                        data: data.demographics.colleges.values,
                        backgroundColor: ['#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd', '#8c564b']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {
                        padding: {
                            left: 0,
                            right: 0,
                            top: 0,
                            bottom: 0
                        }
                    },
                    plugins: {
                        datalabels: {
                            formatter: (value, ctx) => {
                                let sum = 0;
                                let dataArr = ctx.chart.data.datasets[0].data;
                                dataArr.map(data => {
                                    sum += data;
                                });
                                let percentage = (value * 100 / sum).toFixed(2) + "%";
                                return percentage;
                            },
                            color: '#fff',
                            font: {
                                weight: 'bold',
                                size: 14,
                            }
                        }
                    },
                    devicePixelRatio: window.devicePixelRatio,
                    title: {
                        display: true,
                        text: 'College Distribution',
                        fontSize: 16
                    }
                }
            });
            
            // Year of Study Chart
            const yearStudyCtx = document.getElementById('yearStudyChart').getContext('2d');
            new Chart(yearStudyCtx, {
                type: 'bar',
                data: {
                    labels: data.demographics.years_of_study.labels,
                    datasets: [{
                        label: 'Year of Study Distribution',
                        data: data.demographics.years_of_study.values,
                        backgroundColor: '#00C49A'
                    }]
                },
                options: { 
                    responsive: true,
                    devicePixelRatio: window.devicePixelRatio,
                    title: {
                        display: true,
                        text: 'Year of Study Distribution',
                        fontSize: 16
                    },
                    scales: {
                        yAxes: [{
                            ticks: {
                                fontSize: 12
                            }
                        }],
                        xAxes: [{
                            ticks: {
                                fontSize: 12
                            }
                        }]
                    }
                }
            });
            
            // New Mental Health Charts
            // PHQ Severity Chart
            const phqCtx = document.getElementById('phqChart').getContext('2d');
            new Chart(phqCtx, {
                type: 'bar',
                data: {
                    labels: data.mental_health.phq.labels,
                    datasets: [{
                        label: 'PHQ-9 Severity',
                        data: data.mental_health.phq.values,
                        backgroundColor: '#4e79a7'
                    }]
                },
                options: { 
                    responsive: true,
                    scales: {
                        yAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: 'Number of Students',
                                fontSize: 14
                            },
                            ticks: {
                                fontSize: 12
                            }
                        }],
                        xAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: 'Severity Levels',
                                fontSize: 14
                            },
                            ticks: {
                                fontSize: 12
                            }
                        }]
                    },
                    devicePixelRatio: window.devicePixelRatio,
                    title: {
                        display: true,
                        text: 'PHQ-9 Severity',
                        fontSize: 16
                    }
                }
            });
            
            // GAD Severity Chart
            const gadCtx = document.getElementById('gadChart').getContext('2d');
            new Chart(gadCtx, {
                type: 'bar',
                data: {
                    labels: data.mental_health.gad.labels,
                    datasets: [{
                        label: 'GAD-7 Severity',
                        data: data.mental_health.gad.values,
                        backgroundColor: '#f28e2b'
                    }]
                },
                options: { 
                    responsive: true,
                    scales: {
                        yAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: 'Number of Students',
                                fontSize: 14
                            },
                            ticks: {
                                fontSize: 12
                            }
                        }],
                        xAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: 'Severity Levels',
                                fontSize: 14
                            },
                            ticks: {
                                fontSize: 12
                            }
                        }]
                    },
                    devicePixelRatio: window.devicePixelRatio,
                    title: {
                        display: true,
                        text: 'GAD-7 Severity',
                        fontSize: 16
                    }
                }
            });
            
            // GHQ Severity Chart
            const ghqCtx = document.getElementById('ghqChart').getContext('2d');
            new Chart(ghqCtx, {
                type: 'bar',
                data: {
                    labels: data.mental_health.ghq.labels,
                    datasets: [{
                        label: 'GHQ-12 Score Distribution',
                        data: data.mental_health.ghq.values,
                        backgroundColor: '#76b7b2'
                    }]
                },
                options: { 
                    responsive: true,
                    scales: {
                        yAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: 'Number of Students',
                                fontSize: 14
                            },
                            ticks: {
                                fontSize: 12
                            }
                        }],
                        xAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: 'Score Category',
                                fontSize: 14
                            },
                            ticks: {
                                fontSize: 12
                            }
                        }]
                    },
                    devicePixelRatio: window.devicePixelRatio,
                    title: {
                        display: true,
                        text: 'GHQ-12 Score Distribution',
                        fontSize: 16
                    }
                }
            });
            
            // New Scatter Plots
            const phqVsGadScatterCtx = document.getElementById('phqVsGadScatter').getContext('2d');
            new Chart(phqVsGadScatterCtx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'PHQ vs GAD Score',
                        data: data.scatter_plots.phq_vs_gad,
                        backgroundColor: 'rgba(78, 121, 167, 0.8)'
                    }]
                },
                options: {
                    responsive: true,
                    title: {
                        display: true,
                        text: 'PHQ vs GAD Score Correlation',
                        fontSize: 16
                    },
                    scales: {
                        xAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: 'PHQ Score',
                                fontSize: 14
                            },
                            ticks: {
                                fontSize: 12
                            }
                        }],
                        yAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: 'GAD Score',
                                fontSize: 14
                            },
                            ticks: {
                                fontSize: 12
                            }
                        }]
                    },
                    devicePixelRatio: window.devicePixelRatio
                }
            });
            
            const gadVsGhqScatterCtx = document.getElementById('gadVsGhqScatter').getContext('2d');
            new Chart(gadVsGhqScatterCtx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'GAD vs GHQ Score',
                        data: data.scatter_plots.gad_vs_ghq,
                        backgroundColor: 'rgba(255, 99, 132, 0.8)'
                    }]
                },
                options: {
                    responsive: true,
                    title: {
                        display: true,
                        text: 'GAD vs GHQ Score Correlation',
                        fontSize: 16
                    },
                    scales: {
                        xAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: 'GAD Score',
                                fontSize: 14
                            },
                            ticks: {
                                fontSize: 12
                            }
                        }],
                        yAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: 'GHQ Score',
                                fontSize: 14
                            },
                            ticks: {
                                fontSize: 12
                            }
                        }]
                    },
                    devicePixelRatio: window.devicePixelRatio
                }
            });

            const phqVsGhqScatterCtx = document.getElementById('phqVsGhqScatter').getContext('2d');
            new Chart(phqVsGhqScatterCtx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'PHQ vs GHQ Score',
                        data: data.scatter_plots.phq_vs_ghq,
                        backgroundColor: 'rgba(118, 183, 178, 0.8)'
                    }]
                },
                options: {
                    responsive: true,
                    title: {
                        display: true,
                        text: 'PHQ vs GHQ Score Correlation',
                        fontSize: 16
                    },
                    scales: {
                        xAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: 'PHQ Score',
                                fontSize: 14
                            },
                            ticks: {
                                fontSize: 12
                            }
                        }],
                        yAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: 'GHQ Score',
                                fontSize: 14
                            },
                            ticks: {
                                fontSize: 12
                            }
                        }]
                    },
                    devicePixelRatio: window.devicePixelRatio
                }
            });
        feather.replace();
    </script>
</body>
</html>